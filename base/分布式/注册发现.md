url： https://gobea.cn/blog/detail/Yo8Pm9oZ.html
### 微服务组成部分
1. 服务描述
    
    类似服务的说明文档，简单但不可或缺。比如，服务调用首先要解决的问题就是服务如何对外描述。比如，你对外提供了一个服务，那么这个服务的服务名叫什么？调用这个服务需要提供哪些信息？调用这个服务返回的结果是什么格式的？该如何解析？这些就是服务描述要解决的问题。
2. 注册中心
    
    了服务的接口描述，下一步要解决的问题就是服务的发布和订阅，就是说你提供了一个服务(Provider)，如何让外部(Consumer)想调用你的服务的人知道。这个时候就需要一个类似注册中心(Registry)的角色，服务提供者将自己提供的服务以及地址登记到注册中心，服务消费者则从注册中心查询所需要调用的服务的地址，然后发起请求。
   
3. 服务框架

    通过注册中心，服务消费者就可以获取到服务提供者的地址，有了地址后就可以发起调用。但在发起调用之前你还需要解决以下几个问题。服务通信采用什么协议？是RESTful API还是gRPC？数据传输采用什么方式数据压缩采用什么格式？这些活通常集成到了我们的服务框架里面，市面上有很多这样的开源框架，相对都比较成熟，接下来考验你的是快速上手的能力。
4. 服务监控

    通常来讲，服务监控主要包括三个流程，指标收集，数据处理，数据展示。监控是为了发现问题和异常，如果要进一步跟踪和定位问题，则需要进一步了解服务追踪。
5. 服务追踪
    
    除了需要对服务调用情况进行监控之外，你还需要记录服务调用经过的每一层链路，以便进行问题追踪和故障定位，最后达到接近问题的目的。服务监控和追踪可以合并起来，但是要明确各自的职责是不一样的。
6. 服务治理

    服务监控能够发现问题，服务追踪能够定位问题所在，而解决问题就得靠服务治理了。服务治理就是通过一系列的手段来保证在各种意外情况下，服务调用仍然能够正常进行。

### 微服务体系
1. 通信框架
2. 通信协议
3. 序列号和反序列化

### gRPC简介
* `HTTP/2`

    通信协议采用了 HTTP/2，因为 HTTP/2 提供了连接复用、双向流、服务器推送、请求优先级、首部压缩等机制，所以在通信过程中可以节省带宽、降低 TCP 连接次数、节省 CPU，尤其对于移动端应用来说，可以帮助延长电池寿命。
* IDL

    IDL 使用了ProtoBuf，ProtoBuf 是由 Google 开发的一种数据序列化协议，它的压缩和传输效率极高，语法也简单，所以被广泛应用在数据存储和通信协议上。
* 多语言支持

    能够基于多种语言自动生成对应语言的客户端和服务端的代码。

### 注册中心原理
在微服务架构下，主要有三种角色:服务提供者(RPC Server)、服务消费者(RPC Client)和服务注册中心(Registry)，三者的交互关系请看下面这张图，我来简单解释一 下。

* RPC Server

    RPC Server 提供服务，在启动时，根据服务发布文件 server.xml 中的配置的信息，向 Registry `注册自身服务`，并向 Registry `定期发送心跳`汇报存活状态。

* RPC Client

    RPC Client 调用服务，在启动时，根据服务引用文件 client.xml 中配置的信息，向 Registry `订阅服务`，把 Registry 返回的服务节点列表`缓存在本地内存`中，并与 RPC Sever 建立连接。

    当 RPC Server 节点发生变更时，Registry 会同步变更，RPC Client 感知后会刷新本地 内存中缓存的服务节点列表。

    RPC Client 从本地缓存的服务节点列表中，基于负载均衡算法选择一台 RPC Sever 发起 调用。

* 注册中心
    
    根据注册中心原理的描述，注册中心必须提供以下最基本的 API，例如:
    * 服务注册接口
        服务提供者通过调用服务注册接口来完成服务注册。- 一般使用租约或者TTL，PUT设置值
    * 服务反注册（注销）接口
        服务提供者通过调用服务反注册接口来完成服务注销。 - 一般是delete
    * 心跳汇报接口
        服务提供者通过调用心跳汇报接口完成节点存活状态上报。 - 一般使用租约来续租
    * 服务订阅接口
        服务消费者通过调用服务订阅接口完成服务订阅，获取可用的服务提供者节点列表。 - 一般是watch接口
    * 服务变更查询接口
        服务消费者通过调用服务变更查询接口，获取最新的可用服务节点列表。- 一般是get

除此之外，为了便于管理，注册中心还必须提供一些后台管理的 API，例如:

    * 服务查询接口: 查询注册中心当前注册了哪些服务信息。
    * 服务修改接口: 修改注册中心中某一服务的信息。