####音娱 一面
1. Golang 线程模型 GMP  vs JAVA 线程模型 vs PHP (每个子线程为啥处理1024个请求就杀掉重新创建)
2. Golang context 取消信号，如何执行？ A —> B;  B goutine 如何取消信号


    context.withCancel
3. mongo 性能问题；索引如何创建；数据量有多少
4. Panic: 有没有不会导致程序崩溃的panic; recover 不能捕获哪类panic， goroutine 中的panic 可以被捕获吗？
   

    panic都会导致崩溃，除非在defer中捕获panic; recover只有再defer中调用才生效，他和panic做用域要一样
5.算法？？

###滴滴 一面
1. memcache 线程模型  多线程  string
2. redis 线程模型  数据结构  资源竞争 io多路复用模型-reactor
3. 线程和进程的区别
4. 事务隔离级别及问题、解决
5. mvcc实现原理
6. mq 如何实现可靠性消费；消息提交方式：自动提交、手动提交区别，使用场景
   1. 同一个消费组的消费者不重复同一个分区的消息
   2. 重复消费-接口幂等性
7. mysql 和 tidb 对比，tidb 分布式协议 raft
```
有一层无状态的 SQL Layer ，兼容绝大多数 MySQL 语法，对外暴露 MySQL 网络协议，
负责解析用户的 SQL 语句，生成分布式的 Query Plan，翻译成底层 Key Value 操作发送给 TiKV ， 
TiKV 是真正的存储数据的地方，是一个分布式 Key Value 数据库，支持弹性水平扩展
```
```azure
* 纯分布式架构，拥有良好的扩展性，支持弹性的扩缩容
* 支持 SQL，对外暴露 MySQL 的网络协议，并兼容大多数 MySQL 的语法，在大多数场景下可以直接替换 MySQL
* 默认支持高可用，在少数副本失效的情况下，数据库本身能够自动进行数据修复和故障转移，对业务透明
* 支持 ACID 事务，对于一些有强一致需求的场景友好，例如：银行转账
* 具有丰富的工具链生态，覆盖数据迁移、同步、备份等多种场景
``` 
```
Raft 协议
接下来 TiKV 的实现面临一件更难的事情：如何保证单机失效的情况下，数据不丢失，不出错？
TiKV 选择了 Raft 算法。Raft 是一个一致性协议，本文只会对 Raft 做一个简要的介绍，细节问题可以参考它的论文。Raft 提供几个重要的功能：
* Leader（主副本）选举
* 成员变更（如添加副本、删除副本、转移 Leader 等操作）
* 日志复制
TiKV 利用 Raft 来做数据复制，每个数据变更都会落地为一条 Raft 日志，通过 Raft 的日志复制功能，将数据安全可靠地同步到复制组的每一个节点中。
不过在实际写入中，根据 Raft 的协议，只需要同步复制到多数节点，即可安全地认为数据写入成功。

##### 总结一下
通过单机的 RocksDB，TiKV 可以将数据快速地存储在磁盘上；通过 Raft，将数据复制到多台机器上，以防单机失效。
数据的写入是通过 Raft 这一层的接口写入，而不是直接写 RocksDB。
通过实现 Raft，TiKV 变成了一个分布式的 Key-Value 存储，少数几台机器宕机也能通过原生的 Raft 协议自动把副本补全，可以做到对业务无感知。
```
8. mysql 索引结构 平衡树特点及优势（防止二叉树退化成链表）
9. 延时队列的实现（没有用过rocketmq 就过了）
10. 算法题：LRU算法的实现。

### 蓝湖面试
1. kafka topic 突然堆积怎么办？
```
重要的是确定原因，通过日志查看消费任务是否正常，如果正常的话看消费能力是否需要提升。
   存量消息：提升消费能力
   （1） 实时/消费任务挂掉，
   a. 任务重新启动后直接消费最新的消息，对于"滞后"的历史数据采用离线程序进行"补漏"。
   b. 任务启动从上次提交offset处开始消费处理
   （2） Kafka分区数设置的不合理（太少）和消费者"消费能力"不足：考虑增加 topic 的 partition 的个数，同时提升消费者组的消费者数量，消费数 = 分区数 （二者缺一不可）注意：扩容后会导致rebalance
   （3）批量拉取消息，多线程消费消息。批次拉取数量过少（拉取数据/处理时间 < 生产速度），使处理的数据小于生产的数据，也会造成数据积压。（考虑动态配置参数、考虑offset提交方式）
   增量消息：
   （1） 也可以考虑topic拆分到其他topic中；
   （2） Kafka消息的key不均匀，导致分区间数据不均衡
   a. 可以在Kafka producer处，给key加随机后缀，使其均衡
```
2. rpc通信过程中如何保证有序性
   1. 提示：点对点，A ->B , B->A 
   2. 通过一致性hash算法，保证同一个ordeid的数据都给同一台服务器。同一台服务器，可以根据请求的先后顺序放到缓存队列里，在用线程去消费队列
3. mysql 主从存在延迟怎么办？
   1. 强制读主怎么实现？需要修改代码吗？连接池
   2. 选择性读主：利用redis缓存；
4. mysql 互斥锁、共享锁 sql怎么写
   1. select ... from ... FOR UPDATE; 默认排他锁
   2. select ... from ... LOCK IN SHARE MODE; 读锁共享锁
5. 索引是否命中的问题

###百度 一面
1. 数据库乐观锁如何实现？
```bigquery
1、版本号机制；
   一般是说在数据表中加上一个数据库版本号version字段，在表述数据被修改的次数当数据被修改时，它的version 值会加1。
   当然线程A需要更新数据值时，在读取数据的同时也会读取 version 值，在提交更新时，若刚才读取到的 version 值为当前数据库中的 version 值相等时才更新，否则重试更新操作，直到更新成功。
2、CAS算法

```

2. 索引创建语句
```bigquery
alter table *** add PRIMARY KEY(a, b, c)
alter table *** add UNIQUE (a, b, c)
alter table *** add INDEX idx_abc(a, b, c)
create index 索引名 on 表名(字段名);
alter table *** add FULLTEXT idx_abc(a, b, c)
```
3. 切片的扩容策略

   如果切片目标长度大于=原长度2倍，按照目标长度扩容；
   否则：
   如果切片长度<1024,按照2倍进行扩容；
   否则，每次扩容原容量1/4, 直到大于等于目标长度。

4. crontab 定时任务规则
   分钟 小时 日 月 星期 mycommand

5. 正则（没有用，所以没有问）
6. xss攻击原理
7. sql: 数据量很大时，分页查询很慢，怎么办
   语句：select name,id from users limit 1, 10
   面试官解释：没有查询条件，有limit会全表扫描，导致查询很慢；
   优化：加查询条件，如 加1些条件，如id > 某个范围；

8. linux命令：日志文件筛选出302的日志行：
``` 
grep -n 302 log | sort | uniq | wc -l
 -n: 显示行号
-C 10: 打印匹配行的前后10行数据
-A 10: 打印匹配行的后10行数据
-B 10: 打印匹配行的前10行数据
-e: 使用正则搜索
-i: 不区分大小写
-v: 查找不包含指定内容的行
-w: 按单词搜索
-c: 统计匹配到的次数

wc: 统计文件中的字节数、字数、行数
-c: 统计字节数
-w: 统计字符数
-l: 统计行数

sort 命令：对文件内容进行排序
-k：以哪个区间 (field) 来进行排序
-n：依照数值的大小排序
-o<输出文件>：将排序后的结果存入指定的文件
-r：降序
-u：忽略相同行
-t<分隔字符>：指定分隔符，默认的分隔符为空白字符和非空白字符之间的空字符

eg: 文件排序：第三列相同时，按照第一列降序排列
sort -t $'\t' -k 3n -k 1 sort.log

awk -F '|' '{print $1}' log.txt | sort | uniq -c | sort -nrk 1 -t ' '| head -5
sed -n '30745,30790p' catalina.out
```
###知乎 一面
1. https和http的区别，已经https的通信流程
2. 地址栏输入一个网址，访问到服务器的过程
3. tcp三次握手
4. mysql的隔离级别，间隙锁，锁范围
5. mvcc多版本控制
6. 给一个二叉树，说出前中后序遍历结果，问这个二叉树满足堆的条件嘛
7. redis使用场景，缓存热点数据怎么做的
### 蓝湖 一面
1. 数据库主从复制延时怎么办
2. 数据库事务rr级别下死锁，为什么
3. kafka消息堆积了怎么办，偏移量维护在哪.工作流程..
4. etcd 怎么保证的分布式一致性
5. grpc 的protobuf怎么二进制序列化的，有用json做grpc嘛？ 网关层是怎么做的